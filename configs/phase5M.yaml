
experiment:
  name: "phase5M"
  output_dir: "outputs/phase3"

model:
  backbone: "efficientnetv2_m"   # o "mobilenetv3"
  num_classes: 7

teacher:
  name: "resnet50"               # teacher único

knowledge_distillation:
  type: "hybrid"                 # <-- HYBRID: CE + KL + RKD-Distance
  alpha: 0.50                    # CE (student vs labels)
  beta: 0.30                     # KL (teacher vs student)  -> ON
  gamma: 0.20                    # RKD-Distance            -> ON
  temperature: 4.0
  use_distance: true
  use_angle: false
  teacher_adapter_ce: 0.05       # CE pequeña para estabilizar el adapter 2048->7

loss:
  type: "focal"                  # puedes usar "focal" o "ce"
  gamma: 2.0
  label_smoothing: 0.05

train:
  epochs: 100
  batch_size: 32
  learning_rate: 0.0002          # EffV2-M: 2e-4 ; (MNV3 suele 3e-4)
  optimizer: "adamw"
  scheduler: "onecycle"
  weight_decay: 0.05
  patience: 10
  min_epochs: 20
  val_every: 1
  num_workers: 2
  grad_clip_norm: 1.0
  kd_warmup_epochs: 3            # warm-up: solo CE (KL/RKD OFF) + adapter CE ON
  amp: true
  # Si quieres continuar desde el best de Exp-4.1 (opcional):
  #   - para mobilenetv3: outputs/phase3/mobilenetv3/exp4/checkpoints/best_weights_mobilenetv3.pt
  #   - para efficientnetv2_m: outputs/phase3/efficientnetv2_m/exp4/checkpoints/best_weights_efficientnetv2_m.pt
  init_checkpoint: "/kaggle/working/modelFER/outputs/phase3/mobilenetv3/exp4/checkpoints/best_weights_mobilenetv3.pt"
  require_init_checkpoint: true  # falla si no existe (para no arrancar de cero)

input:
  size: [224, 224, 3]
  augmentations: ["randaugment","randomerasing","flip"]

datasets:
  affectnet:
    train_dir: "/kaggle/input/affectnet-fase3/AffectNet/train"
    val_dir:   "/kaggle/input/affectnet-fase3/AffectNet/val"
    test_dir:  "/kaggle/input/affectnet-fase3/AffectNet/test"

  rafdb:
    train_dir: "/kaggle/input/raf-db/RAF-DB/train"
    val_dir:   "/kaggle/input/raf-db/RAF-DB/val"
    test_dir:  "/kaggle/input/raf-db/RAF-DB/test"

  # SOLO evaluación cross-corpus:
  fer2013:
    test_dir: "/kaggle/input/fer-2013/test"
  ckplus:
    root_dir: "/kaggle/input/ck-fer/CK+"

classes: ["angry","disgust","fear","happy","sad","surprise","neutral"]

affectnet_map:
  "0": "angry"
  "1": "disgust"
  "2": "fear"
  "3": "happy"
  "4": "neutral"
  "5": "sad"
  "6": "surprise"
  "7": null

rafdb_map:
  "1": "surprise"
  "2": "fear"
  "3": "disgust"
  "4": "happy"
  "5": "sad"
  "6": "angry"
  "7": "neutral"